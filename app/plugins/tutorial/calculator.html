<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 5.0 Transitional//EN">
<html>
    <head>
        <title>
            Sharding calculator
        </title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/starter-template.css" rel="stylesheet">
        <link rel="icon" href="../images/favicon.ico" type="image/x-icon">
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <body lang="en-US" dir="ltr">
        <main role="main" class="container"><div ng-app="calculator" ng-controller="CalculatorController"><div class="starter-template">

            <h1>
                Sharding calculator
            </h1>

            <div class="row">
                <div class="col-lg-6">
                    <p class="sub-heading">
                        A simple tool to calculate some generic sharding recommendation for a crate table.
                    </p>
                </div>
                <div class="col-lg-6">
                    <h3>
                        read from existing table
                    </h3>
                    <select ng-model="selectTable" ng-options="t as t for t in tables" ng-change="tableSelected()"></select>
                </div>
            </div>
            <h2>
                Hardware
            </h2>
            <h3>
                CPUs
            </h3>
            <p>
                How many cores do the machines have you are going to run your
                nodes on?
            </p>

                <fieldset>
                    <input value="2" ng-model="CPUCoresPerNode" type="number" style="width:auto;color:black" ng-pattern="/^[0-9]/" min="1" max="1024">
                </fieldset>

            <h3>
                Storage
            </h3>
            <p>
                You are using SSDs instead of HDDs? Good.
            </p>

            <h3>
                RAM/Storage
            </h3>
            <p>
                The proportion of RAM and storage generally influences the
                performance. A ratio around 1:24 is recommended, if you do not care
                for speed that much, you can go a little below that, if you do, you
                can go higher, but astronomical are not really improve performance
                anymore.
            </p>

            <fieldset>
                <span>
                    Every GB of RAM serves&nbsp;
                </span>
                <input value="24" ng-model="RAMStorageProportion" type="number" style="width:auto;color:black" ng-pattern="/^[0-9]/" min="16" max="32">
                <span>
                    &nbsp;GB of storage.
                </span>
            </fieldset>

            <h3>
                RAM
            </h3>
            <p>Each node is expected to have 64GB of RAM, since this is the max without causing major garbage collection
                issues.
            </p>

            <h3>
                RAID?
            </h3>
            <p>
                Crate.io is distributed and self healing, replicas of the data are
                distributed among the cluster, if they are enabled. This is probably
                something you want, because it makes something like RAID1 superfluous
                and even enables the use of RAID0 in a safe way.
            </p>
            <h2>
                Use-Case
            </h2>
            <h3>
                Data
            </h3>
            <p>
                So, this is what crate is about. You have probably been using
                something else before, so you should generally know how much data
                there is.
            </p>

            <fieldset>
                <p>
                <input type="radio" ng-model="dataType" value="perTime" style="width:auto;color:black" checked>
                    How much is being inserted?
                </p>

                <fieldset ng-disabled="dataType!='perTime'">

                    <input value='100' style="width:auto;color:black" ng-model="dataInsertedPerTime" type="number" ng-pattern="/^[0-9]/" min="1">

                    <select style="width:auto;color:black" ng-model="dataInsertedPerTimeUnitPrefix">
                        <option value="Mega">Mega
                        <option value="Giga">Giga
                        <option value="Terra">Terra
                    </select>

                    <span>
                        &nbsp;Byte per&nbsp;
                    </span>

                    <select style="width:auto;color:black" ng-model="dataInsertedPerTimeTemporalUnit">
                        <option value="hour">hour
                        <option value="day">day
                        <option value="week">week
                        <option value="month">month
                    </select>

                    <p>
                        And for how long is it supposed to be stored?
                    </p>

                    <input value='6' style="width:auto;color:black" ng-model="keepTime" type="number" ng-pattern="/^[0-9]/" min="1">

                    <select style="width:auto;color:black" ng-model="keepTimeTemporalUnit">
                        <option value="hour">hour
                        <option value="day">day
                        <option value="week">week
                        <option value="month">month
                        <option value="year">year
                    </select>

                </fieldset>
            </fieldset>

            <p>
                Since crate is horizontally scalable you can also later decide that
                the data is supposed to be stored for longer, by adding nodes.
            </p>

            <fieldset>
                <p>
                <input type="radio" style="width:auto;color:black" ng-model="dataType" value="absolute">
                    OR, if itâ€™s really not known yet, just specify some expected
                    table size.
                </p>

                <fieldset ng-disabled="dataType!='absolute'">

                    <input value='10' style="width:auto;color:black" ng-model="expectedTableSize" type="number" ng-pattern="/^[0-9]/" min="1">

                    <select style="width:auto;color:black" ng-model="expectedTableSizeUnitPrefix">
                        <option value="Mega">Mega
                        <option value="Giga">Giga
                        <option value="Terra">Terra
                    </select>

                    <span>
                        &nbsp;Byte
                    </span>

                </fieldset>
            </fieldset>

            <h3>
                Partitioning
            </h3>
            <p>
                Crate organizes data by itself into logical units, usually by
                time. If a good time frame for partitioning is set, this can enhance
                the performance greatly.
            </p>

            <fieldset>
                <fieldset ng-disabled="dataType!='perTime'">
                    <p ng-hide="dataType=='absolute'">
                        Choose a batch size in which the data will be used later. If you have no idea, a month is a good suggestion. <br/>
                        <input value='1' style="width:auto;color:black" ng-model="partitionSize" type="number" ng-pattern="/^[0-9]/" min="1">

                        <select style="width:auto;color:black" ng-change="partitions()" ng-model="partitionSizeTemporalUnit">
                            <option value="hour">hour
                            <option value="day">day
                            <option value="week">week
                            <option value="month">month
                            <option value="year">year
                        </select>
                    </p>
                </fieldset>

                <fieldset ng-disabled="dataType!='absolute'">
                    <p ng-hide="dataType!='absolute'">
                        You have expected table size selected, in this case you need to specify
                        the amount of partitions manually <br/>
                        <input value='4' style="width:auto;color:black" ng-model="manualPartitionCount" type="number" ng-pattern="/^[0-9]/" min="1"> partitions.
                    </p>
                </fieldset>
            </fieldset>

            <h3>
                Redundancy
            </h3>
            <p>
                As said crate distributes replicas of the data among its network,
                one replica should be affordable storage wise, for redundancy and
                data integrity. Having no replicas is of course easy on storage but
                not advisable. By having more replicas the query speed can be
                enhanced significantly, because one query then can run on several
                copies of the same data simultaneously. Sadly that is very storage
                intense and does affect the write speed a little. So one replica is
                the normal way to go if you are very into query speed you can go with
                3-4. Aside from that, having more replicas than nodes never makes
                sense. They have nowhere to go.
            </p>

            <fieldset>
                <input value='1' style="width:auto;color:black" ng-model="replicas" type="number" ng-pattern="/^[0-9]/" min="0">
            </fieldset>

            <h2>
                Calculation
            </h2>

            <p>
                With the data provided this little script came up with a recommendation.
            </p>
            <h4>
                nodes
            </h4>
            <p>
                You should use
                <span class="result" ng-bind="neededNodes()"></span>
                nodes with
                <span class="result" ng-bind="ramString()"></span>
                of RAM and
                <span class="result" ng-bind="storageString()"></span>
                of storage each.
            </p>

            <h4>
                shards
            </h4>
            <p>
                The partitions should be divided into
                <span class="result" ng-bind="result()"></span>
                shards each.
            </p>


        </div></div></main>
    </body>
</html>
